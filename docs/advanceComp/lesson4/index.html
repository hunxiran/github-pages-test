<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">


<title data-react-helmet="true">Evan You on Vue Core | My Site</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="My Site"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="import useBaseUrl from &#x27;@docusaurus/useBaseUrl&#x27;;"><meta data-react-helmet="true" property="og:description" content="import useBaseUrl from &#x27;@docusaurus/useBaseUrl&#x27;;"><meta data-react-helmet="true" property="og:url" content="https://hunxiran.github.io/github-pages-test/docs/advanceComp/lesson4">

<link data-react-helmet="true" rel="shortcut icon" href="/github-pages-test/img/favicon.ico">


<link rel="stylesheet" href="/github-pages-test/styles.86f508d4.css">


<link rel="preload" href="/github-pages-test/styles.3c206ebc.js" as="script">

<link rel="preload" href="/github-pages-test/runtime~main.c736536b.js" as="script">

<link rel="preload" href="/github-pages-test/main.cffd56a0.js" as="script">

<link rel="preload" href="/github-pages-test/1.7d177562.js" as="script">

<link rel="preload" href="/github-pages-test/2.e8941075.js" as="script">

<link rel="preload" href="/github-pages-test/1be78505.d78347c7.js" as="script">

<link rel="preload" href="/github-pages-test/e501b165.735ab011.js" as="script">

<link rel="preload" href="/github-pages-test/17896441.4270d505.js" as="script">

<link rel="preload" href="/github-pages-test/b11293cc.4f5f964a.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/github-pages-test/"><img class="navbar__logo" src="/github-pages-test/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">My Site</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/github-pages-test/docs/doc1">Docs</a><a class="navbar__item navbar__link" href="/github-pages-test/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/docusaurus">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/github-pages-test/"><img class="navbar__logo" src="/github-pages-test/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">My Site</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/github-pages-test/docs/doc1">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/docusaurus">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="sidebarLogo_3ono"><img src="/github-pages-test/img/logo.svg" alt="My Site Logo"><strong>My Site</strong></div><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Docusaurus</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/doc1">Style Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/doc2">Document Number 2</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/doc3">This is Document Number 3</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/mdx">Powered by MDX</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">AdvanceComp</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/advanceComp/lesson1">Lesson1</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/advanceComp/lesson2">Lesson2</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/advanceComp/lesson3">Lesson3</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/github-pages-test/docs/advanceComp/lesson4">Lesson4</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/advanceComp/lesson5">Lesson5</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/advanceComp/lesson6">Lesson6</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/advanceComp/lesson7">Lesson7</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/advanceComp/lesson8">Lesson8</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/advanceComp/lesson9">Lesson9</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/advanceComp/lesson10">Lesson10</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/advanceComp/lesson11">Lesson11</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">VueEssential</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/vueEssential/lesson1">lesson1</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/vueEssential/lesson2">lesson2</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/vueEssential/lesson3">lesson3</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/vueEssential/lesson4">lesson4</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/vueEssential/lesson5">lesson5</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/vueEssential/lesson6">lesson6</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/vueEssential/lesson7">lesson7</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/vueEssential/lesson8">lesson8</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/vueEssential/lesson9">lesson9</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reactivty</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/reactivity/lesson1">Introduce</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/reactivity/lesson2">Proxy and Reflect</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/reactivity/lesson3">ActiveEffect and Ref</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/reactivity/lesson4">Reading Source</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/reactivity/lesson5">Reactivity</a></li><li class="menu__list-item"><a class="menu__link" href="/github-pages-test/docs/reactivity/lesson6">Commentary</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Evan You on Vue Core</h1></header><div class="markdown"><p>In our last lesson we walked through the code base to find reactivity. I showed Evan the following diagram and asked him about any design choices he made along the way.</p><img alt="vueCore1" src="/github-pages-test/img/vueCore1.png"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="constructor-the-place-where-it-all-begins"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#constructor-the-place-where-it-all-begins" title="Direct link to heading">#</a>Constructor: the place where it all begins</h2><p>When we create a new <code>Vue</code> instance using <code>new Vue({…})</code> it calls the Vue <code>constructor</code> function. This function is pretty basic. It just calls the <code>_init</code> prototype method of Vue passing the <code>options</code> as the argument.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-js codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//src/core/instance/index.js</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">Vue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="little-tweaks-for-performance"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#little-tweaks-for-performance" title="Direct link to heading">#</a>Little tweaks for performance</h2><p>As Evan mentions refactors that were made to rule out some edge cases and improve performance. One such place is where a different strategy is used to merge all the options into <code>vm.$options</code> of an instance that is instantiating many components.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-js codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//src/core/instance/init.js</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">options </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">_isComponent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// optimize internal component instantiation</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// since dynamic options merging is pretty slow, and none of the</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// internal component options needs special treatment.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">initInternalComponent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">$options</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">mergeOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">resolveConstructorOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    options </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    vm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><p>This is a common pattern we can observe in the code base where such optimization tweaks were made over time.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="question-are-proxies-already-used"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#question-are-proxies-already-used" title="Direct link to heading">#</a>Question: Are proxies already used?</h2><p>This isn’t a simple answer, Yes and No.</p><p>-<strong>No:</strong> proxies are not used in the reactivity system yet.
-<strong>Yes:</strong> proxies are used to improve developer experience for browsers that support them.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-js codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//src/core/instance/init.js</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token constant" style="color:rgb(130, 170, 255)">NODE_ENV</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!==</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;production&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//used during development</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">initProxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">_renderProxy</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> vm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><p>If a developer calls a method that doesn’t exist in our component options, a proxy’s <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/has">has()</a> trap is used to catch the mistake and throw a warning. This looks like:</p><img alt="vueCore2" src="/github-pages-test/img/vueCore2.png"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="the-sequence-of-code-execution"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-sequence-of-code-execution" title="Direct link to heading">#</a>The sequence of code execution</h2><p>Evan shows us the sequence in which the Vue instance is set up and how each lifecycle hook is executed. He points out that understanding this code makes debugging easy.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-js codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//src/core/instance/init.js</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">initLifecycle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">initEvents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">initRender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">callHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;beforeCreate&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">initInjections</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// resolve injections before data/props</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">initState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">initProvide</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// resolve provide after data/props</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">callHook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;created&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></code></pre></div><ul><li><p><code>initLifecycle(vm)</code>: this sets up some initial properties like $parent, $refs etc on the vue instance.</p></li><li><p><code>initEvents(vm)</code>: sets up methods related to custom events like <code>vm.$emit</code>, <code>vm.$on</code>, <code>vm.$once</code> etc.</p></li><li><p><code>initRender(vm)</code>: sets up the <code>render()</code> and <code>update()</code> methods on the instance.</p></li><li><p><code>callHook(vm, &#x27;beforeCreate&#x27;)</code>: the beforeCreate() lifecycle hook is called. Also, plugins like vuex add their properties to the instance in this hook.</p></li><li><p><code>initInjections(vm)</code>: this is where all the <a href="https://vuejs.org/v2/guide/components-edge-cases.html#Dependency-Injection">dependency-injections</a> are set that are provided using the <code>provide</code> option by the parent.</p></li><li><p><code>initState(vm)</code>: this is where all the props, methods, data, computed and watchers are initialized. You can see the sequence they are initialized below:</p></li></ul><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-js codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//src/core/instance/state.js</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">opts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">initProps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> opts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">props</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">opts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">methods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">initMethods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> opts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">methods</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">opts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">initData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">observe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">_data</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* asRootData */</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">opts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">computed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">initComputed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> opts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">computed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">opts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">watch</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> opts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">watch</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!==</span><span class="token plain"> nativeWatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">initWatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> opts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">watch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><p>The sequence of initialization explains why <code>data</code> properties can be accessed in <code>computed</code> properties and not vice-versa.</p><ul><li><p><code>initProvide(vm)</code>: the <a href="https://vuejs.org/v2/api/#provide-inject">provide</a> option is resolved</p></li><li><p><code>callHook(vm, &#x27;created&#x27;)</code>: this is where the <code>created()</code> lifecycle hook is called. As you see from the sequence <code>initState()</code> is called before calling this hook. So all the <code>data</code>, <code>props</code>, <code>methods</code> and <code>computed</code> are already initialized. That’s the reason we are able to use them in <code>created()</code>.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="where-our-data-option-is-initialized-and-made-reactive"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#where-our-data-option-is-initialized-and-made-reactive" title="Direct link to heading">#</a>Where our data option is initialized and made reactive</h2><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-js codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//src/core/instance/state.js</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword module" style="font-style:italic">export</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">initState</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">vm</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token parameter"> Component</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">opts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">initData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">observe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">_data</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* asRootData */</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><p><code>initData(vm)</code> is where the <code>data</code> option is checked. If it is a function then the <code>data</code> option should return an object otherwise a warning will be displayed in the console.</p><p>We now loop through the data properties and proxy them onto the instance. This means that we can access our data property named <code>foo</code> using <code>this.foo</code> instead of <code>this.$data.foo</code>. It also performs a check to not have conflicting names in our <code>data</code>, <code>props</code> and <code>methods</code>.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-js codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">initData</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">vm</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token parameter"> Component</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> data </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> vm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">$options</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">data</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// checks if data is function or object</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//proxies the data properties onto the instance</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// observe data</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">observe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* asRootData */</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></code></pre></div><p>Finally the <code>observe(data,true)</code> is called. This is where our normal data properties become reactive as we have discussed in the previous lessons.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="the-observer-class"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-observer-class" title="Direct link to heading">#</a>The Observer class</h2><p>The <code>observe(data)</code> function uses the <code>Observer</code> class. This Observer class is used to make code easier to organize and its main purpose is to convert the <code>data</code> properties into <code>getters/setters</code>. This is where <code>dep.depend()</code> and <code>dep.notify</code>() are called as we have seen in the previous lessons.</p><p>Evan elaborates on how the relationship between a particular dependency and its computation works. A computation is collected as a subscriber to that particular dependency of which it is a part of.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="why-a-separate-observer-class"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#why-a-separate-observer-class" title="Direct link to heading">#</a>Why a separate Observer class?</h2><p>Evan clarifies that in the future this <code>Observer</code> class could be its own stand-alone package. This allows for the flexibility of creating a separate Observer class that uses proxies API. The two observers can be used in an interchangeable fashion so Vue can support both IE11 and evergreen browsers. This is projected for the Vue version 3.x as shown below:</p><img alt="vueCore3" src="/github-pages-test/img/vueCore3.png"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="up-next"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#up-next" title="Direct link to heading">#</a>Up Next</h2><p>Now that we have a greater understanding of the Vue source &amp; reactivity, we can begin our understanding of the Template Rendering process in the next lesson.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/advanceComp/lesson4.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/github-pages-test/docs/advanceComp/lesson3"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« Reactivity in Vuejs</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/github-pages-test/docs/advanceComp/lesson5"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Template Compilation »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#constructor-the-place-where-it-all-begins" class="contents__link">Constructor: the place where it all begins</a></li><li><a href="#little-tweaks-for-performance" class="contents__link">Little tweaks for performance</a></li><li><a href="#question-are-proxies-already-used" class="contents__link">Question: Are proxies already used?</a></li><li><a href="#the-sequence-of-code-execution" class="contents__link">The sequence of code execution</a></li><li><a href="#where-our-data-option-is-initialized-and-made-reactive" class="contents__link">Where our data option is initialized and made reactive</a></li><li><a href="#the-observer-class" class="contents__link">The Observer class</a></li><li><a href="#why-a-separate-observer-class" class="contents__link">Why a separate Observer class?</a></li><li><a href="#up-next" class="contents__link">Up Next</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/github-pages-test/docs/doc1">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/github-pages-test/docs/doc2">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/questions/tagged/docusaurus">Stack Overflow</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://discordapp.com/invite/docusaurus">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/github-pages-test/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/docusaurus">GitHub</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://twitter.com/docusaurus">Twitter</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 My Project, Inc. Built with Docusaurus.</div></div></div></footer>
</div>

<script src="/github-pages-test/styles.3c206ebc.js"></script>

<script src="/github-pages-test/runtime~main.c736536b.js"></script>

<script src="/github-pages-test/main.cffd56a0.js"></script>

<script src="/github-pages-test/1.7d177562.js"></script>

<script src="/github-pages-test/2.e8941075.js"></script>

<script src="/github-pages-test/1be78505.d78347c7.js"></script>

<script src="/github-pages-test/e501b165.735ab011.js"></script>

<script src="/github-pages-test/17896441.4270d505.js"></script>

<script src="/github-pages-test/b11293cc.4f5f964a.js"></script>


</body>
</html>